import Decompile
import Preprocess
import time
import os
import shutil

def removeCorruptedFolders(path):
    content = os.listdir(path)
    if('smali' not in content or 'AndroidManifest.xml' not in content or 'apktool.yml' not in content):
        shutil.rmtree(path)
#'''
# unpacking using apktool
for filename in os.listdir("apks"):
    fileNameWithoutSpaces = filename.replace(' ','')
    os.rename(os.path.join('apks',filename), os.path.join('apks',fileNameWithoutSpaces))
    os.system('apktool d ' + os.path.join("apks" ,fileNameWithoutSpaces) +' -o '
              + os.path.join('output',fileNameWithoutSpaces))

# remove corrupted folders
outputFolder = os.listdir("output")
for folder in outputFolder:
    removeCorruptedFolders(os.path.join('output',folder))
#'''

#set apk filename
foldername = 'output'
# decompile apk file
t0 = time.time() # start time
#Decompile.decompile(filename)
# preprocess decompiled data
Preprocess.preprocess(foldername)
print(time.time() - t0) #print total time

'''
features = open('features.txt','w')
for methodFeatures in featuresMatrix:
    features.write(str(methodFeatures) + '\n')
'''




